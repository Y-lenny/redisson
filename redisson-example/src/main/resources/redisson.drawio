<mxfile host="drawio-plugin" modified="2022-02-09T09:55:04.404Z" agent="5.0 (Macintosh; Intel Mac OS X 10_16_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36" etag="Sbpb7Ae8fZec2q1AwFy2" version="14.7.4" type="embed" pages="4"><diagram id="23iRSUPoRavnBvh4doch" name="架构"><mxGraphModel dx="656" dy="605" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/></root></mxGraphModel></diagram><diagram id="tK4jmSt8CIQ9CdjSliBU" name="加锁"><mxGraphModel dx="1506" dy="605" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="RqDHGJpM4KkF9-Bl3EqA-0"/><mxCell id="RqDHGJpM4KkF9-Bl3EqA-1" parent="RqDHGJpM4KkF9-Bl3EqA-0"/><mxCell id="49Dky37XaEfgBZ7VfboT-85" value="循环获取+等待" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="30" y="880" width="210" height="510" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-39" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint y="660" as="targetPoint"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-39" value="&lt;span style=&quot;font-weight: 700&quot;&gt;lua 脚本执行逻辑&lt;/span&gt;" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-480" y="211" width="960" height="419" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-0" target="49Dky37XaEfgBZ7VfboT-1" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-0" value="" style="shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-20" y="1" width="40" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-1" target="49Dky37XaEfgBZ7VfboT-39" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-5" value="判断锁是否存在" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-4" vertex="1" connectable="0"><mxGeometry x="-0.2" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-1" target="49Dky37XaEfgBZ7VfboT-3" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-1" value="获取锁" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-60" y="111" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-3" target="49Dky37XaEfgBZ7VfboT-15" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-17" value="判断标识是否相同" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-16" vertex="1" connectable="0"><mxGeometry x="0.05" y="1" relative="1" as="geometry"><mxPoint y="-21" as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-21" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-16" vertex="1" connectable="0"><mxGeometry x="0.225" y="3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-3" target="49Dky37XaEfgBZ7VfboT-25" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-27" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-26" vertex="1" connectable="0"><mxGeometry x="-0.25" y="-3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-3" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-40" y="241" width="80" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-15" target="49Dky37XaEfgBZ7VfboT-18" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-22" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-19" vertex="1" connectable="0"><mxGeometry x="0.3333" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-24" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-15" target="49Dky37XaEfgBZ7VfboT-23" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-15" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-200" y="241" width="80" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-31" value="null" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-18" target="49Dky37XaEfgBZ7VfboT-28" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="-320" y="481"/></Array></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-18" value="hincrby + 1 重入锁&lt;br&gt;pexpire 刷新过期时间" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-380" y="231" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-23" target="49Dky37XaEfgBZ7VfboT-28" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="-160" y="481"/></Array></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-30" value="剩余时间" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-29" vertex="1" connectable="0"><mxGeometry x="-0.3529" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-23" value="获取线程占用&lt;br&gt;锁的剩余时间" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-220" y="351" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-25" target="49Dky37XaEfgBZ7VfboT-28" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="180" y="481"/></Array></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-33" value="null" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-32" vertex="1" connectable="0"><mxGeometry x="-0.4581" y="2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-25" value="&lt;span&gt;hincrby&amp;nbsp; 加锁&lt;/span&gt;&lt;br&gt;&lt;span&gt;pexpire 刷新过期时间&lt;/span&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="120" y="231" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-28" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint y="660" as="targetPoint"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-44" value="根据结果判断锁获取是否成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-43" vertex="1" connectable="0"><mxGeometry relative="1" as="geometry"><mxPoint y="54" as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-28" value="&lt;span&gt;返回结果&lt;/span&gt;" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-60" y="451" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-45" target="49Dky37XaEfgBZ7VfboT-46" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-50" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-47" vertex="1" connectable="0"><mxGeometry x="0.1" y="2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-45" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="100" y="680" as="targetPoint"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-51" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-49" vertex="1" connectable="0"><mxGeometry x="-0.4" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-45" value="ttl == null ?" style="rhombus;whiteSpace=wrap;html=1;verticalAlign=middle;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-40" y="660" width="80" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-46" value="获取成功返回true" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-220" y="650" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-52" target="49Dky37XaEfgBZ7VfboT-54" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-59" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-55" vertex="1" connectable="0"><mxGeometry x="-0.0857" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-57" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-52" target="49Dky37XaEfgBZ7VfboT-56" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-58" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-57" vertex="1" connectable="0"><mxGeometry x="-0.4667" y="-4" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-52" value="time &amp;lt;=0" style="rhombus;whiteSpace=wrap;html=1;verticalAlign=middle;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="100" y="660" width="80" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-53" value="等待时间是否超时" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="20" y="650" width="110" height="20" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-54" target="49Dky37XaEfgBZ7VfboT-60" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-63" value="订阅成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-61" vertex="1" connectable="0"><mxGeometry x="-0.075" y="1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-54" value="订阅锁释放消息" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="80" y="770" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-56" value="获取锁失败返回false" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="240" y="650" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-60" target="49Dky37XaEfgBZ7VfboT-64" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-66" value="获取锁" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-65" vertex="1" connectable="0"><mxGeometry relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-60" value="循环获取+阻塞等待&lt;br&gt;直到超时" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="80" y="910" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-64" target="49Dky37XaEfgBZ7VfboT-39" edge="1"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="540" y="1080"/><mxPoint x="540" y="421"/></Array></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-69" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-64" target="49Dky37XaEfgBZ7VfboT-68" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-64" value="同上获取锁流程" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="80" y="1050" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-71" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-68" target="49Dky37XaEfgBZ7VfboT-70" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-77" value="判断获取锁时间是否超时" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-71" vertex="1" connectable="0"><mxGeometry x="0.0571" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-68" value="根据ttl设置阻塞时间&lt;br&gt;(信号量)" style="whiteSpace=wrap;html=1;strokeColor=#FF0000;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="80" y="1190" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-81" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-70" target="49Dky37XaEfgBZ7VfboT-80" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-82" value="退出等待" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-81" vertex="1" connectable="0"><mxGeometry x="0.0286" y="3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-70" value="time &amp;lt;= 0" style="rhombus;whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="100" y="1320" width="80" height="40" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-70" target="49Dky37XaEfgBZ7VfboT-60" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-79" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="49Dky37XaEfgBZ7VfboT-78" vertex="1" connectable="0"><mxGeometry x="0.0696" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-75" value="&amp;nbsp; &amp;nbsp;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="45" y="1330" width="30" height="20" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-84" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="49Dky37XaEfgBZ7VfboT-80" target="49Dky37XaEfgBZ7VfboT-83" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-80" value="取消订阅" style="whiteSpace=wrap;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="80" y="1430" width="120" height="60" as="geometry"/></mxCell><mxCell id="49Dky37XaEfgBZ7VfboT-83" value="" style="shape=waypoint;size=6;pointerEvents=1;points=[];fillColor=#2a2a2a;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="120" y="1580" width="40" height="40" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-1" value="" style="shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;image=https://imgconvert.csdnimg.cn/aHR0cDovL2ltZy1oeHkwMjEuZGlkaXN0YXRpYy5jb20vc3RhdGljL2ttL2RvMV9XUWhKVHUzZmFkTTJJVkplblMyVQ?x-oss-process=image/format,png;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-558.88" y="1660" width="1117.76" height="460" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="_wcAnFVCdLrjEkwBiUiG-2" target="_wcAnFVCdLrjEkwBiUiG-3" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-2" value="添加加锁完成&lt;br&gt;监视器(看门狗)" style="whiteSpace=wrap;html=1;verticalAlign=middle;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="-60" y="550" width="120" height="60" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="_wcAnFVCdLrjEkwBiUiG-3" target="_wcAnFVCdLrjEkwBiUiG-5" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-3" value="创建TimeTask&lt;br&gt;&amp;amp;&lt;br&gt;间隔(过期时间/3)&lt;br&gt;触发锁续期动作" style="whiteSpace=wrap;html=1;verticalAlign=middle;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="140" y="550" width="120" height="60" as="geometry"/></mxCell><mxCell id="_wcAnFVCdLrjEkwBiUiG-5" value="执行eval lua脚本" style="whiteSpace=wrap;html=1;verticalAlign=middle;" parent="RqDHGJpM4KkF9-Bl3EqA-1" vertex="1"><mxGeometry x="340" y="550" width="120" height="60" as="geometry"/></mxCell><mxCell id="Rj-W-VPOz0q_0gRGXVSu-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#FF0000;" edge="1" parent="RqDHGJpM4KkF9-Bl3EqA-1" source="Rj-W-VPOz0q_0gRGXVSu-0" target="49Dky37XaEfgBZ7VfboT-68"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Rj-W-VPOz0q_0gRGXVSu-0" value="释放锁产生消息&lt;br&gt;获取消息释放信号量解除阻塞" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;strokeColor=#FF0000;" vertex="1" parent="RqDHGJpM4KkF9-Bl3EqA-1"><mxGeometry x="400" y="1190" width="120" height="60" as="geometry"/></mxCell></root></mxGraphModel></diagram><diagram id="fQqCzKtzF3DgFl7NatAs" name="释放锁"><mxGraphModel dx="875" dy="807" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="FtOxdp4FoJrqNpidOOyt-0"/><mxCell id="FtOxdp4FoJrqNpidOOyt-1" parent="FtOxdp4FoJrqNpidOOyt-0"/><mxCell id="ugT2tfHX3oIrmij3O4_P-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="ugT2tfHX3oIrmij3O4_P-0" target="ugT2tfHX3oIrmij3O4_P-1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="ugT2tfHX3oIrmij3O4_P-0" value="" style="shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="310" y="10" width="40" height="40" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="ugT2tfHX3oIrmij3O4_P-1" target="Wkuw51UYzaNRmcvWGLRd-0"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-2" value="判断锁是否存在" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Wkuw51UYzaNRmcvWGLRd-1"><mxGeometry x="-0.1714" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="ugT2tfHX3oIrmij3O4_P-1" value="&lt;span style=&quot;font-size: 11px&quot;&gt;释放锁&lt;/span&gt;" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="270" y="120" width="120" height="60" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-0" target="Wkuw51UYzaNRmcvWGLRd-3"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-5" value="N" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Wkuw51UYzaNRmcvWGLRd-4"><mxGeometry x="-0.2" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-0" target="Wkuw51UYzaNRmcvWGLRd-6"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-8" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Wkuw51UYzaNRmcvWGLRd-7"><mxGeometry x="-0.3333" y="-2" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-0" value="Y/N" style="rhombus;whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="290" y="250" width="80" height="40" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-3" target="Wkuw51UYzaNRmcvWGLRd-17"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="170" y="610"/></Array></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-3" value="直接返回null" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="110" y="240" width="120" height="60" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-6" target="Wkuw51UYzaNRmcvWGLRd-9"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-11" value="判断重入次数" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Wkuw51UYzaNRmcvWGLRd-10"><mxGeometry x="0.0571" y="-1" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-6" value="根据key+mkey获取值" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="430" y="240" width="120" height="60" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-9" target="Wkuw51UYzaNRmcvWGLRd-12"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-16" value="Y" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="Wkuw51UYzaNRmcvWGLRd-13"><mxGeometry x="-0.2333" y="-3" relative="1" as="geometry"><mxPoint as="offset"/></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-15" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-9" target="Wkuw51UYzaNRmcvWGLRd-14"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-9" value="count &amp;gt; 0" style="rhombus;whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="450" y="370" width="80" height="40" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-12" target="Wkuw51UYzaNRmcvWGLRd-17"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="650" y="610"/></Array></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-12" value="更新锁过期时间" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="590" y="360" width="120" height="60" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-14" target="Wkuw51UYzaNRmcvWGLRd-17"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="490" y="610"/></Array></mxGeometry></mxCell><mxCell id="lp2BBk4c137GcGwgoKN--2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#FF0000;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-14" target="lp2BBk4c137GcGwgoKN--1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-14" value="删除锁标识&lt;br&gt;发布锁释放消息" style="whiteSpace=wrap;html=1;fillColor=none;sketch=0;strokeColor=#FF0000;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="430" y="480" width="120" height="60" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-17" target="Wkuw51UYzaNRmcvWGLRd-21"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-17" value="返回结果" style="whiteSpace=wrap;html=1;strokeColor=#f0f0f0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="270" y="580" width="120" height="60" as="geometry"/></mxCell><mxCell id="vZj60rYYcrjTJu8h7SGp-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-21" target="vZj60rYYcrjTJu8h7SGp-0"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="1PwBMGNd2cJ8kNiWJ0bp-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#f0f0f0;" edge="1" parent="FtOxdp4FoJrqNpidOOyt-1" source="Wkuw51UYzaNRmcvWGLRd-21"><mxGeometry relative="1" as="geometry"><mxPoint x="330" y="860" as="targetPoint"/></mxGeometry></mxCell><mxCell id="Wkuw51UYzaNRmcvWGLRd-21" value="添加释放锁&lt;br&gt;完成监视器" style="whiteSpace=wrap;html=1;strokeColor=#f0f0f0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="270" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="vZj60rYYcrjTJu8h7SGp-0" value="取消锁续期(看门狗)" style="whiteSpace=wrap;html=1;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="470" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="lp2BBk4c137GcGwgoKN--0" value="" style="shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;strokeColor=#f0f0f0;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="310" y="840" width="40" height="40" as="geometry"/></mxCell><mxCell id="lp2BBk4c137GcGwgoKN--1" value="释放锁消息" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=none;sketch=0;strokeColor=#FF0000;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="700" y="480" width="120" height="60" as="geometry"/></mxCell><UserObject label="加锁" link="data:page/id,tK4jmSt8CIQ9CdjSliBU" id="D14OuqJiQjRUOPDOQhx0-0"><mxCell style="fontColor=#0000EE;fontStyle=4;rounded=1;overflow=hidden;spacing=10;strokeColor=#FF0000;" vertex="1" parent="FtOxdp4FoJrqNpidOOyt-1"><mxGeometry x="750" y="450" width="60" height="40" as="geometry"/></mxCell></UserObject></root></mxGraphModel></diagram><diagram id="rCGMAXmKqBB_6W4VxRx6" name="锁续期"><mxGraphModel dx="656" dy="605" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="bWbNcQvj16rqp0mDby1Y-0"/><mxCell id="bWbNcQvj16rqp0mDby1Y-1" parent="bWbNcQvj16rqp0mDby1Y-0"/></root></mxGraphModel></diagram></mxfile>